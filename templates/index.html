{% extends "layout.html" %}

{% block title %}Index{% endblock %}

{% block content %}
	<div id="dailyChart">

	</div>

	<div id='footerArea'>
		{% if validDate %}
			<a href='{{ date|date_modify("-1 day")|date("Y-m-d")}}'>Previous</a>
			{% if dayStats|raw|length != 2 %}
				<span id='footerText'>Currently viewing statistics for {{ date|date("d/m/Y") }}.</span>
			{% else %}
				<span id='footerText'>No statistics available yet for {{ date|date("d/m/Y") }}.</span>
			{% endif %}
			<a href='{{ date|date_modify("+1 day")|date("Y-m-d")}}'>Next</a>
		{% else %}
			<font color='red'>An invalid date has been entered!</font>
		{% endif %}
	</div>
{% endblock %}

{% block extra_bottomjs %}
	<script src="{{ app.request.basepath }}js/highcharts/highcharts.js"></script>
	<script src="{{ app.request.basepath }}js/highcharts/modules/exporting.js"></script>

	<script type="text/javascript">
		var chartStats = {{ dayStats|raw }};

		function drawChart(renderDiv)
		{
			var chartConfig = {
				chart: {
					type: 'area',
					renderTo: renderDiv
				},
				title: {
					text: 'Energy production',
					x: -20
				},
				plotOptions: {
					area: {
						shadow: false,
						states: {
							hover: {
								lineWidth: 2
							}
						},
						marker: {
							enabled: false,
							states: {
								hover: {
									enabled: true,
									radius: 4,
									lineWidth: 1
								}
							}
						}
					}
				},
				xAxis: {
					type: 'datetime',
       				tickInterval: 7200000,
				},
				yAxis: {
					title: {
						text: 'kW'
					},
					plotLines: [{
						value: 0,
						width: 1,
						color: '#808080'
					}],
				},
				credits: {
					enabled:false
				},
				tooltip: {
					valueSuffix: 'kW',
					snap:1
				},
				legend: {
					layout: 'vertical',
					align: 'right',
					verticalAlign: 'middle',
					borderWidth: 0
				},
				series: [{
					name: 'kW generated',
					data: chartStats	
				}]
			};

			// -------------------------------------------------------------------------

			new Highcharts.Chart(chartConfig);
		}

		$( document ).ready(function() {
			if(chartStats.length > 0) {
				drawChart('dailyChart');
			}
		});
	</script>
{% endblock %}